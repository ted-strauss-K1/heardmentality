<!DOCTYPE html>
<meta charset="utf-8">

<link href="src/nv.d3.css" rel="stylesheet" type="text/css">

<body>

  <div id="chart">
    <svg style="height: 500px;"></svg>
  </div>

<script src="lib/d3.v3.js"></script>
<script src="lib/crossfilter.js"></script>

<script src="nv.d3.js"></script>
<script src="src/tooltip.js"></script>
<script src="src/utils.js"></script>
<script src="src/models/legend.js"></script>
<script src="src/models/axis.js"></script>
<script src="src/models/scatter.js"></script>
<script src="src/models/line.js"></script>
<script src="src/models/lineWithFocusChart.js"></script>
<script src="stream_layers.js"></script>


<script>


  function normalizeData(data, series, xAxis)
  {
    var sort = crossfilter.quicksort.by(function(d) { return d[xAxis]; });
    var sorted = sort(data, 0, data.length);

    var result = [];

    series.forEach(function(serie, index)
    {
      result.push({key: serie.name, values: [], color: serie.color});
    });

    data.forEach(function(data, dataIndex)
    {
      series.forEach(function(serie, serieIndex)
      {
        result[serieIndex].values.push({x: data[xAxis],  y: data[serie.key]});
      });
    });

    return result;
  };

  nv.addGraph(function() {
    var chart = nv.models.lineWithFocusChart();

    //
    chart.xAxis.tickFormat(d3.format(',f'));
    chart.x2Axis.tickFormat(d3.format(',f'));

    chart.yAxis.tickFormat(d3.format(',.2f'));
    chart.y2Axis.tickFormat(d3.format(',.2f'));

    //
    var data = [];
    for (var i=0; i<=100; i++) {
      var data_item = {};
      data_item['x'] = i;
      data_item['stream1'] = Math.log(i+5);
      data_item['stream2'] = Math.random();
      data.push(data_item);
    }

    //
    var data = crossfilter(data);

    var dimension = data.dimension(function(d) { return d.y; });

    var data = normalizeData(dimension.top(Infinity),
      [
        {
          name: 'Stream #1',
          key: 'stream1'
        },
        {
          name: 'Stream #2',
          key: 'stream2'
        }

      ], 'x');

    d3.select('#chart svg')
      .datum(data)
      .transition().duration(500)
      .call(chart);

    nv.utils.windowResize(chart.update);

    return chart;
  });



</script>
