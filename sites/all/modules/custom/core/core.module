<?php

/**
 * Include content types
 */
include_once('core.features.inc');

/**
 * Implementation of hook_nodeapi()
 *
 * @param $node
 * @param $op
 * @param null $a3
 * @param null $a4
 */
function core_nodeapi(&$node, $op, $a3 = NULL, $a4 = NULL)
{
  if ('issue' == $node->type) {
    switch ($op) {
      case 'view' :
        # description
        // todo translation
        $node->description = trim_better($node->content['body']['#value'], 2500);
        $node->description_f = $node->content['body']['#value'];
        $node->description_s = $node->description != $node->description_f;
        drupal_add_js(drupal_get_path('module', 'core') . '/core.js');

        # args
        $node->debate = argument_get_list($node->nid, $node->info);

      break;
      case 'insert' :
      case 'update' :
        //
      break;
    }
  }
}

/**
 * @param $node
 */
function node_reload(&$node)
{
  $cid = 'content:' . $node->nid . ':' . $node->vid;
  cache_clear_all($cid, content_cache_tablename());
  $node = node_load($node->nid, NULL, TRUE);
}